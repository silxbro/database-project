# 02. Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Íµ¨Ï∂ï
<br/>

## üñ•Ô∏è Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ ÌôòÍ≤Ω ÏÑ§Ï†ï
### [1] Docker Í∏∞Î∞ò MySQL Î°úÏª¨ ÏÑúÎ≤Ñ

#### ‚óºÔ∏é SSHÎ•º ÌôúÏö©Ìïú EC2 ÏÑúÎ≤Ñ Ïô∏Î∂Ä Ï†ëÏÜç
```
# ÌîÑÎùºÏù¥Îπó ÌÇ§ ÌååÏùº(.pem) Ï°¥Ïû¨ Í≤ΩÎ°úÎ°ú Ïù¥Îèô ÌõÑ, ÌîÑÎùºÏù¥Îπó ÌÇ§ Ï°∞Ìöå(READ) Í∂åÌïú Î∂ÄÏó¨
$ chmod 400 bh-EC2.pem

# sshÎ•º ÌÜµÌïú ÏÑúÎ≤Ñ Ï†ëÏÜç
ssh -i "[key-pairÎ™Ö].pem" ubuntu@[ÌçºÎ∏îÎ¶≠ DNS]
```

#### ‚óºÔ∏é EC2 ÏÑúÎ≤ÑÏóê Docker ÏÑ§Ïπò
```
# ÏãúÏä§ÌÖú ÏóÖÎç∞Ïù¥Ìä∏
sudo apt update

# Docker ÌïÑÏàò Ìå®ÌÇ§ÏßÄ ÏÑ§Ïπò
sudo apt install -y apt-transport-https ca-certificates curl software-properties-common

# Docker GPG ÌÇ§ Ï∂îÍ∞Ä
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg

# Docker Ï†ÄÏû•ÏÜå Ï∂îÍ∞Ä
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# Docker ÏÑ§Ïπò
sudo apt update
sudo apt install -y docker-ce

# Docker ÏÑ§Ïπò ÌôïÏù∏
docker --version

# Docker Ïã§Ìñâ
sudo systemctl start docker
```

#### ‚óºÔ∏é MySQL Ïù¥ÎØ∏ÏßÄ Îã§Ïö¥Î°úÎìú
```
# ubuntu ÏÇ¨Ïö©ÏûêÎ•º Docker Í∑∏Î£πÏóê Ï∂îÍ∞Ä: /var/run/docker.sock ÌååÏùº(= Docker Îç∞Î™¨ ÏÜåÏºì) Ï†ëÍ∑º Í∂åÌïú Î∂ÄÏó¨
sudo usermod -aG docker $USER

# EC2 ÏÑúÎ≤Ñ Ï¢ÖÎ£å ÌõÑ Ïû¨Ï†ëÏÜç
exit
ssh -i "[key-pairÎ™Ö].pem" ubuntu@[ÌçºÎ∏îÎ¶≠ DNS]

# MySQL Docker Ïù¥ÎØ∏ÏßÄ Îã§Ïö¥
docker pull mysql:latest

# MySQL Ïª®ÌÖåÏù¥ÎÑà Ïã§Ìñâ
docker run --name [Ïª®ÌÖåÏù¥ÎÑà Ïù¥Î¶Ñ] -e MYSQL_ROOT_PASSWORD=[ÎπÑÎ∞ÄÎ≤àÌò∏] -p 3306:3306 -d mysql:latest

# Ïª®ÌÖåÏù¥ÎÑà ÏÉÅÌÉú ÌôïÏù∏
docker ps
```

#### ‚óºÔ∏é MYSQL Îç∞Ïù¥ÌÑ∞ ÏòÅÏÜçÏÑ± ÏÑ§Ï†ï (Î≥ºÎ•® ÎßàÏö¥Ìä∏ ÏÑ§Ï†ï)
```
# Î≥ºÎ•® ÏÉùÏÑ±
docker volume create mysql-data

# Ïª®ÌÖåÏù¥ÎÑà Î∂àÎ•® ÎßàÏö¥Ìä∏
docker stop mysql-container
docker rm mysql-container
docker run --name mysql-container \
  -e MYSQL_ROOT_PASSWORD=ehpark \
  -v ~/mysql-data:/var/lib/mysql \
  -v ~/mysql-config/my.cnf \
  -p 3306:3306 \
  -d mysql:latest
```

#### ‚óºÔ∏é MYSQL ÏÑúÎ≤Ñ Ï†ëÏÜç
```
# MySQL ÏÑúÎ≤Ñ Ï†ëÏÜç
docker exec -it mysql-container mysql -u root -p
```
<br/>

## üìë DDL Ïä§ÌÅ¨Î¶ΩÌä∏

### [1] ÌÖåÏù¥Î∏î ÏÉùÏÑ±
```sql
-- =============================================
-- File: 01_Create-Tables.sql
-- Description: Create tables for RentCar DB
-- =============================================

-- ÌöåÏõê (MEMBER)
CREATE TABLE IF NOT EXISTS MEMBER (
    member_id      INT AUTO_INCREMENT,
    account_id     VARCHAR(50) NOT NULL UNIQUE,
    account_pw     VARCHAR(50) NOT NULL,
    member_name    VARCHAR(50) NOT NULL,
    birth_date     DATE NOT NULL,
    gender         ENUM('M','F') NOT NULL,
    phone          VARCHAR(20) NOT NULL UNIQUE,
    email          VARCHAR(100) NOT NULL UNIQUE,
    join_date      DATE NOT NULL DEFAULT (CURRENT_DATE),
    withdraw_date  DATE NULL,
    status         VARCHAR(20) NOT NULL DEFAULT 'ACTIVE', -- 'ACTIVE', 'DORMANT', 'SUSPENDED', 'WITHDRAWN'
    PRIMARY KEY (member_id)
);

-- Î©¥Ìóà (LICENSE)
CREATE TABLE IF NOT EXISTS LICENSE (
    license_id      INT AUTO_INCREMENT,
    member_id       INT NOT NULL,
    license_number  VARCHAR(20) NOT NULL UNIQUE,
    license_type    VARCHAR(20) NOT NULL, -- 'DOMESTIC', 'INTERNATIONAL'
    license_class   VARCHAR(20) NOT NULL, -- 'T1_NORMAL', 'T2_NORMAL', 'T1_LARGE', 'T2_AUTO'
    issue_date      DATE NOT NULL,
    expiry_date     DATE NOT NULL,
    PRIMARY KEY (license_id)
);

-- ÏßÄÏ†ê (BRANCH)
CREATE TABLE IF NOT EXISTS BRANCH (
    branch_id    INT AUTO_INCREMENT,
    branch_name  VARCHAR(50) NOT NULL UNIQUE,
    address      VARCHAR(100) NOT NULL,
    phone        VARCHAR(20) NOT NULL,
    open_time    TIME NOT NULL,
    close_time   TIME NOT NULL,
    open_date    DATE NOT NULL,
    close_date   DATE NULL,
    status       VARCHAR(20) NOT NULL DEFAULT 'ACTIVE', -- 'ACTIVE', 'PAUSED', 'CLOSED'
    PRIMARY KEY (branch_id)
);

-- ÏßÄÏ†êÏßÅÏõê (BRANCH_STAFF)
CREATE TABLE IF NOT EXISTS BRANCH_STAFF (
    staff_id      INT AUTO_INCREMENT,
    branch_id     INT NOT NULL,
    staff_number  VARCHAR(20) NOT NULL UNIQUE,
    job_title     VARCHAR(20) NOT NULL, -- 'STAFF', 'MANAGER', 'HEAD'
    staff_name    VARCHAR(20) NOT NULL,
    birth_date    DATE NOT NULL,
    gender        ENUM('M','F') NOT NULL,
    phone         VARCHAR(20) NOT NULL UNIQUE,
    email         VARCHAR(50) NOT NULL UNIQUE,
    hire_date     DATE NOT NULL,
    retire_date   DATE NULL,
    status        VARCHAR(20) NOT NULL DEFAULT 'ACTIVE', -- 'ACTIVE', 'ON_LEAVE', 'RETIRED' 
    PRIMARY KEY (staff_id)
);

-- Ï∞®ÎüâÎ™®Îç∏ (CAR_MODEL)
CREATE TABLE IF NOT EXISTS CAR_MODEL (
    car_model_id    INT AUTO_INCREMENT,
    car_model_type  VARCHAR(20) NOT NULL, -- 'COMPACT_MINI', 'SMALL', 'MEDIUM', 'UPPER_MEDIUM', 'LARGE', 'VAN', 'SUV/RV', 'EV'
    car_model_base  VARCHAR(50) NOT NULL,
    maker_name      VARCHAR(50) NOT NULL,
    fuel_type       VARCHAR(20) NOT NULL, -- 'GASOLINE', 'HYBRID', 'DIESEL', 'ELECTRONIC', 'LPG'
    seat_count      INT NOT NULL,
    reg_date        DATE NOT NULL,
    del_date        DATE NULL,
    status          VARCHAR(20) NOT NULL, -- 'ACTIVE', 'DELETED'
    PRIMARY KEY (car_model_id)
);

-- Ï∞®Îüâ (CAR)
CREATE TABLE IF NOT EXISTS CAR (
    car_id          INT AUTO_INCREMENT,
    branch_id       INT NOT NULL,
    car_model_id    INT NOT NULL,
    car_number      VARCHAR(20) NOT NULL UNIQUE,
    car_year        INT NOT NULL,
    car_mileage     INT NOT NULL,
    fuel_remaining  INT NOT NULL,
    reg_date        DATE NOT NULL,
    del_date        DATE NULL,
    status          VARCHAR(20) NOT NULL, -- 'ACTIVE', 'DELETED'
    PRIMARY KEY (car_id)
);

-- ÎåÄÏó¨ (RENTAL)
CREATE TABLE IF NOT EXISTS RENTAL (
    rental_id       INT AUTO_INCREMENT,
    car_id          INT NOT NULL,
    start_date      DATE NOT NULL,
    end_date        DATE NOT NULL,
    return_date     DATE NULL,
    insurance_type  VARCHAR(20) NOT NULL, -- 'FULL', 'PART', 'NONE'
    start_fuel      INT NOT NULL,
    return_fuel     INT NULL,
    reserve_date    DATE NOT NULL,
    cancel_date     DATE NULL,
    status          VARCHAR(20) NOT NULL, -- 'RESERVED', 'RENTING', 'RETURNED', 'CANCELED'
    PRIMARY KEY (rental_id)
);

-- ÎåÄÏó¨Îì±Î°ùÏö¥Ï†ÑÏûê (RENTAL_DRIVER)
CREATE TABLE IF NOT EXISTS RENTAL_DRIVER (
    rental_id   INT NOT NULL,
    driver_id   INT NOT NULL,
    is_primary  BOOLEAN NOT NULL,
    PRIMARY KEY (rental_id, driver_id)
);

-- Í≤∞Ï†úÎÇ¥Ïó≠ (PAYMENT)
CREATE TABLE IF NOT EXISTS PAYMENT (
    payment_id         INT AUTO_INCREMENT,
    rental_id          INT NOT NULL,
    payment_amount     DECIMAL(20) NOT NULL,
    payment_datetime   DATETIME NOT NULL DEFAULT NOW(),
    payment_type       VARCHAR(20) NOT NULL, -- 'RENTAL', 'COMPENSATION', 'ADDITIONAL'
    payment_method     VARCHAR(50) NOT NULL, -- 'CREDIT_CARD', 'DEBIT_CARD', 'BANK_TRANSFER', 'EASY_PAYMENT'
    payment_method_id  VARCHAR(50) NOT NULL,
    payment_status     VARCHAR(20) NOT NULL DEFAULT 'COMPLETED', -- 'COMPLETED', 'CANCELED'
    PRIMARY KEY (payment_id)
);

-- Í≤∞Ï†úÏÉÅÏÑ∏ÎÇ¥Ïó≠ (PAYMENT_DETAIL)
CREATE TABLE IF NOT EXISTS PAYMENT_DETAIL (
    payment_detail_id      INT AUTO_INCREMENT,
    payment_id             INT NOT NULL,
    policy_id              INT NULL,
    payment_detail_amount  DECIMAL(20) NOT NULL,
    payment_detail_type    VARCHAR(20) NOT NULL, -- 'RENTAL_FEE', 'INSURANCE_FEE', 'DISCOUNT_AMOUNT', 'MILEAGE_EARNED', 'MILEAGE_USED'
    PRIMARY KEY (payment_detail_id)
);

-- Ïö¥ÏòÅÏ†ïÏ±Ö(POLICY)
CREATE TABLE IF NOT EXISTS POLICY (
    policy_id    INT AUTO_INCREMENT,
    policy_type  VARCHAR(20) NOT NULL, -- 'RENTAL_FEE', 'INSURANCE_FEE', 'DISCOUNT', 'MILEAGE'
    PRIMARY KEY (policy_id)
);

-- ÎåÄÏó¨Î£åÏ†ïÏ±Ö (RENTAL_FEE_POLICY)
CREATE TABLE IF NOT EXISTS RENTAL_FEE_POLICY (
    fee_policy_id  INT AUTO_INCREMENT,
    car_model_id   INT NOT NULL,
    fee_amount     DECIMAL(20) NOT NULL,
    start_date     DATE NOT NULL,
    end_date       DATE NOT NULL,
    PRIMARY KEY (fee_policy_id)
);

-- Î≥¥ÌóòÎ£åÏ†ïÏ±Ö (INSURANCE_FEE_POLICY)
CREATE TABLE IF NOT EXISTS INSURANCE_FEE_POLICY (
    fee_policy_id   INT AUTO_INCREMENT,
    car_model_id    INT NOT NULL,
    insurance_type  VARCHAR(20) NOT NULL, -- 'FULL', 'PART', 'NONE'
    fee_amount      DECIMAL(20) NOT NULL,
    start_date      DATE NOT NULL,
    end_date        DATE NOT NULL,
    PRIMARY KEY (fee_policy_id)
);

-- Ìï†Ïù∏Ï†ïÏ±Ö (DISCOUNT_POLICY)
CREATE TABLE IF NOT EXISTS DISCOUNT_POLICY (
    discount_policy_id  INT AUTO_INCREMENT,
    discount_type       VARCHAR(20) NOT NULL, -- 'AMOUNT', 'RATE'
    discount_amount     DECIMAL(20) NULL,
    discount_rate       INT NULL,
    start_date          DATE NOT NULL,
    end_date            DATE NOT NULL,
    PRIMARY KEY (discount_policy_id)
);

-- ÎßàÏùºÎ¶¨ÏßÄÏ†ïÏ±Ö (MILEAGE_POLICY)
CREATE TABLE IF NOT EXISTS MILEAGE_POLICY (
    mileage_policy_id  INT AUTO_INCREMENT,
    earning_type       VARCHAR(20) NOT NULL, -- 'AMOUNT', 'RATE'
    earning_amount     DECIMAL(20) NULL,
    earning_rate       INT NULL,
    start_date         DATE NOT NULL,
    end_date           DATE NOT NULL,
    PRIMARY KEY (mileage_policy_id)
);

-- ÏÇ¨Í≥†Ïù¥Î†• (ACCIDENT)
CREATE TABLE IF NOT EXISTS ACCIDENT (
    accident_id        INT AUTO_INCREMENT,
    rental_id          INT NOT NULL,
    accident_datetime  DATETIME NOT NULL,
    accident_type      VARCHAR(20) NOT NULL,
    accident_location  VARCHAR(100) NOT NULL,
    PRIMARY KEY (accident_id)
);

-- Ï∞®ÎüâÍ¥ÄÎ¶¨Ïù¥Î†• (CAR_MANAGEMENT)
CREATE TABLE IF NOT EXISTS CAR_MANAGEMENT (
    car_management_id  INT AUTO_INCREMENT,
    car_id             INT NOT NULL,
    start_date         DATE NOT NULL,
    end_date           DATE NULL,
    management_type    VARCHAR(20) NOT NULL,
    management_detail  VARCHAR(20) NOT NULL,
    management_cost    DECIMAL(20) NOT NULL,
    management_vendor  VARCHAR(50) NOT NULL,
    status  VARCHAR(20) NOT NULL,
    PRIMARY KEY (car_management_id)
);
```

### [2] Ï†úÏïΩÏ°∞Í±¥ ÏÑ§Ï†ï
```sql
-- =============================================
-- File: 02_Create-Constraints.sql
-- Description: Define FK & CHECK constraints
-- =============================================

-- MEMBER
ALTER TABLE MEMBER
ADD CONSTRAINT chk_member_status CHECK (status IN ('ACTIVE', 'DORMANT', 'SUSPENDED', 'WITHDRAWN'));

-- LICENSE
ALTER TABLE LICENSE
ADD CONSTRAINT fk_license_member REFERENCES MEMBER(member_id) ON DELETE CASCADE ON UPDATE CASCADE,
ADD CONSTRAINT chk_license_type CHECK (license_type IN ('DOMESTIC', 'INTERNATIONAL')),
ADD CONSTRAINT chk_license_class CHECK (license_class IN ('T1_LARGE', 'T1_NORMAL', 'T2_NORMAL', 'T2_AUTO'));

-- BRANCH
ALTER TABLE BRANCH
ADD CONSTRAINT chk_branch_status CHECK (status IN ('ACTIVE', 'PAUSED', 'CLOSED'));

-- BRANCH_STAFF
ALTER TABLE BRANCH_STAFF
ADD CONSTRAINT fk_staff_branch FOREIGN KEY (branch_id) REFERENCES BRANCH(branch_id) ON DELETE CASCADE ON UPDATE CASCADE,
ADD CONSTRAINT chk_staff_status CHECK (status IN ('ACTIVE', 'ON_LEAVE', 'RETIRED')),
ADD CONSTRAINT chk_staff_job_title CHECK (job_title IN ('STAFF', 'MANAGER', 'HEAD'));

-- CAR_MODEL
ALTER TABLE CAR_MODEL
ADD CONSTRAINT chk_car_model_type CHECK (car_model_type IN ('COMPACT_MINI', 'SMALL', 'MEDIUM', 'UPPER_MEDIUM', 'LARGE', 'VAN', 'SUV/RV', 'EV')),
ADD CONSTRAINT chk_car_model_fuel CHECK (fuel_type IN ('GASOLINE', 'HYBRID', 'DIESEL', 'ELECTRONIC', 'LPG')),
ADD CONSTRAINT chk_car_model_status CHECK (status IN ('ACTIVE', 'DELETED'));

-- CAR
ALTER TABLE CAR
ADD CONSTRAINT fk_car_branch FOREIGN KEY (branch_id) REFERENCES BRANCH(branch_id) ON DELETE CASCADE ON UPDATE CASCADE,
ADD CONSTRAINT fk_car_model FOREIGN KEY (car_model_id) REFERENCES CAR_MODEL(car_model_id) ON DELETE CASCADE ON UPDATE CASCADE,
ADD CONSTRAINT chk_car_status CHECK (status IN ('ACTIVE', 'DELETED')),
ADD CONSTRAINT chk_car_fuel_remaining CHECK (fuel_remaining BETWEEN 1 AND 10);

-- RENTAL
ALTER TABLE RENTAL
ADD CONSTRAINT fk_rental_car FOREIGN KEY (car_id) REFERENCES CAR(car_id) ON DELETE CASCADE ON UPDATE CASCADE,
ADD CONSTRAINT chk_rental_status CHECK (status IN ('RESERVED', 'RENTING', 'RETURNED', 'CANCELLED')),
ADD CONSTRAINT chk_rental_insurance_type CHECK (insurance_type IN ('FULL', 'PART', 'NONE')),
ADD CONSTRAINT chk_rental_fuel_range CHECK (start_fuel BETWEEN 1 AND 10 AND (return_fuel IS NULL OR return_fuel BETWEEN 0 AND 10));

-- RENTAL_DRIVER
ALTER TABLE RENTAL_DRIVER
ADD CONSTRAINT fk_driver_rental FOREIGN KEY (rental_id) REFERENCES RENTAL(rental_id) ON DELETE CASCADE ON UPDATE CASCADE,
ADD CONSTRAINT fk_driver_member FOREIGN KEY (driver_id) REFERENCES MEMBER(member_id) ON DELETE CASCADE ON UPDATE CASCADE,
ADD CONSTRAINT uq_rental_primary_driver UNIQUE (rental_id, is_primary) WHERE is_primary = TRUE;

-- PAYMENT
ALTER TABLE PAYMENT
ADD CONSTRAINT fk_payment_rental FOREIGN KEY (rental_id) REFERENCES RENTAL(rental_id) ON DELETE CASCADE ON UPDATE CASCADE,
ADD CONSTRAINT chk_payment_status CHECK (status IN ('PAID', 'CANCELLED')),
ADD CONSTRAINT chk_payment_type CHECK (payment_type IN ('RENTAL', 'COMPENSATION', 'ADDITIONAL')),
ADD CONSTRAINT chk_payment_method CHECK (payment_method IN ('CREDIT_CARD', 'CHECK_CARD', 'TRANSFER', 'EASY_PAY'));

-- PAYMENT_DETAIL
ALTER TABLE PAYMENT_DETAIL
ADD CONSTRAINT fk_payment_detail_payment FOREIGN KEY (payment_id) REFERENCES PAYMENT(payment_id) ON DELETE CASCADE ON UPDATE CASCADE,
ADD CONSTRAINT fk_payment_detail_policy FOREIGN KEY (policy_id) REFERENCES RENTAL_FEE_POLICY(fee_policy_id),
ADD CONSTRAINT chk_payment_detail_type CHECK (payment_detail_type IN ('RENTAL_FEE', 'INSURANCE_FEE', 'DISCOUNT', 'MILEAGE_EARN', 'MILEAGE_USE'));

-- POLICY
ALTER TABLE POLICY
ADD CONSTRAINT chk_policy_type CHECK (policy_type IN ('RENTAL_FEE', 'INSURANCE_FEE', 'DISCOUNT', 'MILEAGE'));

-- RENTAL_FEE_POLICY
ALTER TABLE RENTAL_FEE_POLICY
ADD CONSTRAINT fk_rental_fee_policy FOREIGN KEY (fee_policy_id) REFERENCES POLICY(policy_id) ON DELETE CASCADE ON UPDATE CASCADE,
ADD CONSTRAINT fk_rental_fee_policy_car_model FOREIGN KEY (car_model_id) REFERENCES CAR_MODEL(car_model_id) ON DELETE CASCADE ON UPDATE CASCADE;

-- INSURANCE_FEE_POLICY
ALTER TABLE INSURANCE_FEE_POLICY
ADD CONSTRAINT fk_insurance_fee_policy FOREIGN KEY (fee_policy_id) REFERENCES POLICY(policy_id) ON DELETE CASCADE ON UPDATE CASCADE,
ADD CONSTRAINT fk_insurance_fee_policy_car_model FOREIGN KEY (car_model_id) REFERENCES CAR_MODEL(car_model_id) ON DELETE CASCADE ON UPDATE CASCADE,
ADD CONSTRAINT chk_insurance_type CHECK (insurance_type IN ('FULL', 'PART', 'NONE'));

-- DISCOUNT_POLICY
ALTER TABLE DISCOUNT_POLICY
ADD CONSTRAINT fk_discount_policy FOREIGN KEY (discount_policy_id) REFERENCES POLICY(policy_id) ON DELETE CASCADE ON UPDATE CASCADE,
ADD CONSTRAINT chk_discount_type CHECK (discount_type IN ('AMOUNT', 'RATE')),
ADD CONSTRAINT chk_discount_rate CHECK (discount_rate BETWEEN 1 AND 100 OR discount_rate IS NULL);

-- MILEAGE_POLICY
ALTER TABLE MILEAGE_POLICY
ADD CONSTRAINT fk_mileage_policy FOREIGN KEY (mileage_policy_id) REFERENCES POLICY(policy_id) ON DELETE CASCADE ON UPDATE CASCADE,
ADD CONSTRAINT chk_earning_type CHECK (earning_type IN ('AMOUNT', 'RATE')),
ADD CONSTRAINT chk_earning_rate CHECK (earning_rate BETWEEN 1 AND 100 OR earning_rate IS NULL);

-- ACCIDENT
ALTER TABLE ACCIDENT
ADD CONSTRAINT fk_accident_rental FOREIGN KEY (rental_id) REFERENCES RENTAL(rental_id) ON DELETE CASCADE ON UPDATE CASCADE,
ADD CONSTRAINT chk_accident_type CHECK (accident_type IN ('COLLISION', 'SOLO', 'PEDESTRIAN', 'NATURAL', 'MECHANICAL', 'OTHER'));

-- CAR_MANAGEMENT
ALTER TABLE CAR_MANAGEMENT
ADD CONSTRAINT fk_car_management_car FOREIGN KEY (car_id) REFERENCES CAR(car_id) ON DELETE CASCADE ON UPDATE CASCADE,
ADD CONSTRAINT chk_management_type CHECK (management_type IN ('MAINTENANCE', 'REPAIR')),
ADD CONSTRAINT chk_management_detail CHECK (management_detail IN ('PERIODIC', 'ADHOC', 'PARTS', 'ENGINE', 'ELECTRIC', 'EXTERIOR', 'BRAKE')),
ADD CONSTRAINT chk_management_status CHECK (status IN ('IN_PROGRESS', 'COMPLETED', 'CANCELLED'));
```

### [3] Ïù∏Îç±Ïä§ Ï†ïÏùò
```sql
-- =============================================
-- File: 03_Create-Indexes.sql
-- Description: Create indexes for RentCar DB
-- =============================================

-- RENTAL
CREATE INDEX idx_rental_status_start_date ON RENTAL (status, start_date);
CREATE INDEX idx_rental_car_period ON RENTAL (car_id, end_date, start_date);

-- CAR
CREATE INDEX idx_car_branch_status ON CAR (branch_id);

-- CAR_MANAGEMENT
CREATE INDEX idx_car_management_car_status_date ON CAR_MANAGEMENT (car_id, status, start_date);
```

#### ‚óºÔ∏é Ïù¥Ìï¥Í¥ÄÍ≥ÑÏûêÎ≥Ñ ÏûêÏ£º ÏÇ¨Ïö©ÎêòÎäî ÏøºÎ¶¨ ÏòàÏãú
```sql
-- ============
--     Í≥†Í∞ù
-- ============

-- ÌöåÏõê Ï†ïÎ≥¥ ÌôïÏù∏/ÏàòÏ†ï
SELECT * 
FROM MEMBER
WHERE account_id = :account_id;

-- ÏòàÏïΩ ÎÇ¥Ïó≠ ÌôïÏù∏
SELECT 
    r.rental_id,
    r.start_date,
    r.end_date,
    r.status,
    c.car_number,
    m.car_model_base,
    b.branch_name,
    rd.is_primary
FROM MEMBER mb, RENTAL_DRIVER rd, RENTAL r, CAR c, CAR_MODEL m, BRANCH b
WHERE mb.account_id = :account_id
  AND rd.driver_id = mb.member_id
  AND r.rental_id = rd.rental_id
  AND c.car_id = r.car_id
  AND m.car_model_id = c.car_model_id
  AND b.branch_id = c.branch_id
  AND r.status IN ('RESERVED', 'RENTING')
ORDER BY r.start_date DESC;

-- ÏßÄÏ†êÎ≥Ñ Ï∞®Îüâ ÌòÑÌô© Î∞è Í∞ÄÏö© Ï∞®Îüâ Ï°∞Ìöå
SELECT 
    c.car_id,
    c.car_number,
    m.car_model_base,
    m.fuel_type,
    c.car_mileage
FROM CAR c, CAR_MODEL m
WHERE c.car_model_id = m.car_model_id
  AND c.branch_id = :branch_id
  AND c.status = 'ACTIVE'
  AND c.car_id NOT IN (
      SELECT r.car_id
      FROM RENTAL r
      WHERE r.start_date < :desired_end_date
        AND r.end_date > :desired_start_date
  );

-- ============
--   ÏßÄÏ†ê ÏßÅÏõê
-- ============

-- ÏßÄÏ†ê Ï∞®Îüâ Í≤ÄÏÉâ
SELECT c.car_id, c.car_number, c.status
FROM CAR c
WHERE c.branch_id = :branch_id AND c.status = 'ACTIVE';

-- ÌòÑÏû¨ ÎÇ†Ïßú Í∏∞Ï§Ä ÎåÄÏó¨ÏòàÏ†ï Í≥ÑÏïΩ Ï°∞Ìöå
SELECT 
    r.rental_id,
    r.start_date,
    r.end_date,
    m.member_name,
    m.phone AS member_phone,
    c.car_number,
    cm.car_model_base,
    b.branch_name
FROM RENTAL r, RENTAL_DRIVER rd, MEMBER m, CAR c, CAR_MODEL cm, BRANCH b, BRANCH_STAFF s
WHERE b.branch_id = s.branch_id
  AND c.branch_id = s.branch_id
  AND r.car_id = c.car_id
  AND r.rental_id = rd.rental_id
  AND rd.driver_id = m.member_id
  AND c.car_model_id = cm.car_model_id
  AND s.staff_number = :staff_number
  AND rd.is_primary = TRUE
  AND r.status = 'RESERVED'
  AND r.start_date <= CURRENT_DATE
ORDER BY r.start_date DESC;

-- Ï∞®Îüâ Í¥ÄÎ¶¨ ÌòÑÌô© Ï°∞Ìöå
SELECT 
    cm.car_management_id,
    c.car_number,
    cm.management_type,
    cm.management_detail,
    cm.management_vendor,
    cm.management_cost,
    cm.start_date,
    cm.end_date,
    cm.status
FROM BRANCH_STAFF s, CAR c, CAR_MANAGEMENT cm
WHERE c.branch_id = s.branch_id
  AND cm.car_id = c.car_id
  AND s.staff_number = :staff_number
  AND c.status = 'ACTIVE'
  AND cm.status = 'IN_PROGRESS'
ORDER BY cm.start_date DESC;
```