# 01. 데이터베이스 설계
<br/>

## 📑 요구사항 분석
### ◼︎ 이해 관계자
- 고객(개인/법인)
- 지점 직원
- 관리자

### ◼︎ 차량 관련 요구사항
- 차량은 고유 식별 번호로 관리됩니다.
- 차량은 모델, 연식, 연료 유형, 좌석 수, 주행 거리 등의 기본 정보를 보유합니다.
- 차량은 관련된 대여, 정비, 사고 정보를 기록합니다.
- 차량은 상태 정보(대여 가능, 대여 중, 정비 중, 수리 중)를 유지합니다.
- 차량은 하나의 지점에 소속되며 각 지점은 여러 대의 차량을 보유 및 관리합니다.

### ◼︎ 대여 관련 요구사항
- 하나의 대여에서 단일 차량만을 사용할 수 있습니다.
- 하나의 대여에서 여러 운전자(고객)를 등록할 수 있으며 한명의 대표 운전자(고객)가 존재합니다.
- 고객은 대여 예약 시 결제를 진행해야 하며 결제 완료 시 대여 계약이 최종 확정됩니다.
- 대여 수령·반납 지점은 모두 대여 차량의 관리 지점이어야 합니다.
- 대여 시 시작일시, 종료일시(반납예정), 차량, 운전자, 적용 보험/할인 정보 등을 필수적으로 포함합니다.
- 반납 시 반납일시, 반납유류량, 손상/사고, 추가 요금 등의 정보가 필수적으로 추가됩니다.
- 대여 시 보험상품에 선택적으로 가입할 수 있습니다.
- 대여는 관련된 결제, 사고 정보를 기록합니다.
- 대여 중 계약 위반 시(손상/사고/연체/유류부족 등) 추가 요금이 자동 계산되어 부과됩니다.

### ◼︎ 결제 관련 요구사항
- 대여료는 차량, 대여 기간, 보험/할인 적용에 따라 자동 계산됩니다.
- 계약 종료 후 추가 요금이 발생할 경우 별도 결제를 해야 합니다.
- 결제 완료 시 할인/마일리지 정책(최대 1개씩 적용 가능)에 따라 관련된 할인·마일리지 정보를 기록합니다.
- 추후 대여 정보가 변경됨에 따라 결제 정보 및 관련 할인·적립 정보가 변경될 수 있습니다.
- 마일리지는 차량 반납이 모두 완료된 대여(계약)에 한하여 적립됩니다.
- 할인율은 기간 및 조건별로 설정됩니다.

### ◼︎ 고객 관련 요구사항
- 고객은 고객ID로 식별할 수 있습니다.
- 고객은 단 하나의 면허 정보를 필수적으로 등록해야 하며 유효한 상태여야 차량을 대여할 수 있습니다.
- 고객은 대여 예약을 등록·변경·취소할 수 있으며 대여 이력에 대한 목록·상세 정보를 조회할 수 있습니다.
- 고객은 보유한 마일리지를 적립·조회·사용할 수 있습니다.

### ◼︎ 지점 직원 관련 요구사항
- 지점 직원은 직원ID로 식별할 수 있습니다.
- 지점 직원은 차량/대여 목록·상세 정보를 조회할 수 있고 자신이 속한 지점의 차량/대여 정보를 관리할 수 있습니다.
- 지점 직원은 사고/보상/정비/수리 정보를 조회・관리할 수 있습니다.
- 지점 직원은 하나의 지점에 소속되며 각 지점에는 여러 명의 직원이 소속되어 있습니다.

### ◼︎ 관리자 관련 요구사항
- 관리자는 전체 고객 계정, 대여 내역, 차량 정보, 지점 정보, 결제/할인 내역 등의 모든 데이터를 조회・관리할 수 있습니다.
- 관리자는 사용자 유형별(고객, 지점 직원, 관리자) 권한을 설정 및 관리할 수 있습니다.
- 관리자는 대여/매출 통계 대시보드를 기반으로 수익, 대여율, 차량 활용률 등을 조회할 수 있습니다.
- 관리자는 전체/마일리지 정책을 등록·변경·삭제할 수 있습니다.
  <br/><br/>

## ✍️ 데이터베이스 설계
### [1] 개념적/논리적 설계

#### ◼︎ 주요 엔티티 및 속성 추출
|논리 엔티티명|물리 엔티티명| 속성                                                                      |
|:---|:---|:------------------------------------------------------------------------------------|
|**고객**|CUSTOMER| **고객ID**, 계정ID, 계정PW, 고객명, 생년월일, 성별, 연락처, 이메일                                                   |
|**면허**|LICENSE| **면허ID**, 면허번호, 면허구분, 면허종류, 면허발급일자, 면허만료일자                                                     |
|**차량**|CAR| **차량ID**, 차량번호, 차량모델, 연료유형, 차량연식, 좌석수, 주행거리, 잔여유류량, 차량상태                                       |
|**지점**|BRANCH| **지점ID**, 지점명, 지점주소, 연락처, 영업시작시간, 영업종료시간                                                         |
|**대여**|RENTAL| **대여ID**, 대여시작일시, 대여종료일시, 차량반납일시, 적용보험, 대여유류량, 반납유류량, 대여상태                                 |
|**결제**|PAYMENT| **결제ID**, 결제일시, 결제유형, 결제수단, 결제수단번호, 결제상태, 결제금액, 대여금액, 보험료, 할인금액,<br/>마일리지사용, 마일리지적립 |
|**할인정책**|DISCOUNT_POLICY| **할인정책ID**, 할인유형, 할인금액, 할인율, 정책시작일자, 정책종료일자                                         |
|**마일리지정책**|MILEAGE_POLICY| **마일리지정책ID**, 적립유형, 적립금액, 적립율, 정책시작일자, 정책종료일자                                    |
|**정비이력**|MAINTENANCE| **정비이력ID**, 정비시작일자, 정비완료일자, 정비유형, 정비비용, 정비업체명                                          |
|**수리이력**|REPAIR| **수리이력ID**, 수리시작일자, 수리완료일자, 수리유형, 수리비용, 수리업체명                                               |
|**사고이력**|ACCIDENT| **사고이력ID**, 사고일시, 사고유형, 사고장소                                                                    |

#### ◼︎ 주요 관계 추출
|관계|참여 엔티티 1|참여 엔티티 2|관계 유형|
|:---|:---|:---|:---|
| **고객-면허** | CUSTOMER | LICENSE | 1:1 |
| **지점-차량** | BRANCH | CAR | 1:N |
| **고객-대여** | CUSTOMER | RENTAL | M:N |
| **차량-대여** | CAR | RENTAL | 1:N |
| **대여-결제** | RENTAL | PAYMENT | 1:N |
| **할인정책-결제** | DISCOUNT_POLICY | PAYMENT | 1:N |
| **마일리지정책-결제** | MILEAGE_POLICY | PAYMENT | 1:N |
| **차량-정비이력** | CAR | MAINTENANCE | 1:N |
| **차량-수리이력** | CAR | REPAIR | 1:N |
| **사고이력-수리이력** | ACCIDENT | REPAIR | 1:N |
| **사고이력-결제** | ACCIDENT | PAYMENT | 1:N |
| **차량-사고이력** | CAR | ACCIDENT | 1:N |
| **대여-사고이력** | RENTAL | ACCIDENT | 1:N |
| **고객-사고이력** | CUSTOMER | ACCIDENT | 1:N |

#### ◼︎ ERD 다이어그램
<img src="image%2Frentcar_erd.svg" width="750" />

### [2] 물리적 설계

#### [CUSTOMER (고객)]
| 컬럼명             | 컬럼 설명 | 데이터 타입 | 길이 | NULL 허용 | PK  | FK  | UQ | 비고              |
|:-----------------|:--------|:---------|:----|:---------|:---:|:---:|:--:|:-----------------|
| customer_id      | 고객ID   | INT      | -   | NOT NULL | ●   |     |    | AUTO_INCREMENT   |
| account_id       | 계정ID   | VARCHAR  | 50  | NOT NULL |     |     | ●  |                  |
| account_password | 계정PW   | VARCHAR  | 50  | NOT NULL |     |     |    |                  |
| customer_name    | 고객명   | VARCHAR  | 50  | NOT NULL |     |     |    |                  |
| birth_date       | 생년월일  | DATE     | -   | NOT NULL |     |     |    | YYYY-MM-DD       |
| gender           | 성별     | VARCHAR  | 10  | NOT NULL |     |     |    | 남성/여성          |
| phone            | 연락처   | VARCHAR  | 20  | NOT NULL |     |     | ●  | '-' 포함         |
| email            | 이메일   | VARCHAR  | 100 | NOT NULL |     |     | ●  |                 |
| is_deleted       | 탈퇴여부  | BOOLEAN  | -   | NOT NULL |     |     |    |                  |

#### [LICENSE (면허)]
| 컬럼명           | 컬럼 설명   | 데이터 타입 | 길이  | NULL 여부 | PK  | FK  | UQ  | 비고                        |
|:---------------|:----------|:---------|:-----|:---------|:---:|:---:|:---:|:---------------------------|
| license_id     | 면허ID     | INT      | -    | NOT NULL | ●   |     |     | AUTO_INCREMENT             |
| customer_id    | 고객ID     | INT      | -    | NOT NULL |     | ●   |     | CUSTOMER 참조               |
| license_number | 면허번호    | VARCHAR  | 20   | NOT NULL |     |     | ●   |                            |
| license_type   | 면허구분    | VARCHAR  | 10   | NOT NULL |     |     |     | 국내/국제                    |
| license_class  | 면허종류    | VARCHAR  | 10   | NOT NULL |     |     |     | 1종대형/1종보통/2종보통/2종오토   |
| issue_date     | 면허발급일자 | DATE     | -    | NOT NULL |     |     |     | YYYY-MM-DD                 |
| expiry_date    | 면허만료일자 | DATE     | -    | NOT NULL |     |     |     | YYYY-MM-DD                 |

#### [CAR (차량)]
| 컬럼명           | 컬럼 설명  | 데이터 타입 | 길이 | NULL 여부 | PK  | FK  | UQ  | 비고                    |
|:---------------|:---------|:---------|:----|:---------|:---:|:---:|:---:|:----------------------|
| car_id         | 차량ID    | INT      | -   | NOT NULL | ●   |     |     | AUTO_INCREMENT        |
| branch_id      | 소속지점ID | INT      | -   | NOT NULL |     | ●   |     | BRANCH 참조             |                  
| car_number     | 차량번호   | VARCHAR  | 20  | NOT NULL |     |     | ●   |                       |
| car_model      | 차량모델   | VARCHAR  | 50  | NOT NULL |     |     |     |                       |
| fuel_type      | 연료유형   | VARCHAR  | 10  | NOT NULL |     |     |     | 가솔린/디젤/전기/하이브리드/LPG   |
| car_year       | 차량연식   | INT      | -   | NOT NULL |     |     |     |                       |
| seat_count     | 좌석수    | INT      | -   | NOT NULL |     |     |     |                       |
| car_mileage    | 주행거리   | INT      | -   | NOT NULL |     |     |     | km 단위                 |
| fuel_remaining | 잔여유류량 | INT      | -   | NOT NULL |     |     |     |                       |
| car_status     | 차량상태   | VARCHAR  | 10  | NOT NULL |     |     |     | 대여가능/예약완료/대여중/정비중/수리중 |
| is_deleted     | 삭제여부   | BOOLEAN  | -   | NOT NULL |     |     |     |                       |

#### [BRANCH (지점)]
| 컬럼명           | 컬럼 설명  | 데이터 타입 | 길이 | NULL 여부 | PK  | FK  | UQ  | 비고                                          |
|:---------------|:---------|:---------|:----|:---------|:---:|:---:|:---:|:---------------------------------------------|
| branch_id      | 지점ID    | INT      | -   | NOT NULL | ●   |     |     | AUTO_INCREMENT                               |
| branch_name    | 지점명     | VARCHAR  | 50  | NOT NULL |     |     | ●   |                                              |
| address        | 지점주소   | VARCHAR  | 100 | NOT NULL |     |     |     |                                              |
| phone          | 연락처     | VARCHAR  | 20  | NOT NULL |     |     |     |                                              |
| open_time      | 영업시작시간 | TIME     | -   | NOT NULL |     |     |     | HH:mm                                        |
| close_time     | 영업종료시간 | TIME     | -   | NOT NULL |     |     |     | HH:mm                                        |
| is_deleted     | 폐점여부    | BOOLEAN  | -   | NOT NULL |     |     |     |                  |

#### [RENTAL (대여)]
| 컬럼명            | 컬럼 설명   | 데이터 타입 | 길이 | NULL 여부  | PK  | FK  | UQ  | 비고                       |
|:----------------|:----------|:---------|:----|:----------|:---:|:---:|:---:|:--------------------------|
| rental_id       | 대여ID     | INT      | -   | NOT NULL  | ●   |     |      | AUTO_INCREMENT           |
| customer_id     | 대표운전자ID | INT      | -   | NOT NULL  |     | ●   |      | CUSTOMER 참조             |
| car_id          | 차량ID     | INT      | -   | NOT NULL  |     | ●   |      | CAR 참조                  |
| start_datetime  | 대여시작일시  | DATETIME | -   | NOT NULL  |     |     |     | YYYY-MM-DD HH:mm         |
| end_datetime    | 대여종료일시  | DATETIME | -   | NOT NULL  |     |     |     | YYYY-MM-DD HH:mm         |
| return_datetime | 차량반납일시  | DATETIME | -   | NULL      |     |     |     | YYYY-MM-DD HH:mm         |
| insurance_type  | 적용보험     | VARCHAR  | 20  | NOT NULL  |     |     |     | 완전보험/부분보험/미적용       |
| start_fuel      | 대여유류량   | INT      | -   | NOT NULL  |     |     |     | 칸 단위(1~10 정수)          |
| return_fuel     | 반납유류량   | INT      | -   | NULL      |     |     |     | 칸 단위(1~10 정수)          |
| rental_status   | 대여상태     | VARCHAR  | 20  | NOT NULL  |     |     |     | 예약완료/대여중/반납완료/취소   |

#### [PAYMENT (결제)]
| 컬럼명                  | 컬럼 설명   | 데이터 타입 | 길이 | NULL 여부  | PK  | FK  | UQ  | 비고                  |
|:----------------------|:----------|:---------|:----|:----------|:---:|:---:|:---:|:--------------------|
| payment_id            | 결제ID     | INT      | -    | NOT NULL | ●   |     |     | AUTO_INCREMENT      |
| rental_id             | 관련대여ID  | INT      | -    | NULL     |     | ●   |     | RENTAL 참조           |
| accident_id           | 관련사고ID  | INT      | -    | NULL     |     | ●   |     | ACCIDENT 참조        |
| payment_datetime      | 결제일시    | DATETIME | -    | NOT NULL |     |     |     | YYYY-MM-DD HH:mm:SS |
| payment_type          | 결제유형    | VARCHAR  | 20   | NOT NULL |     |     |     | 대여/보상/추가          |
| payment_method        | 결제수단    | VARCHAR  | 50   | NOT NULL |     |     |     | 신용카드/체크카드/계좌이체/간편결제 |
| payment_method_id     | 결제수단번호 | VARCHAR  | 50   | NOT NULL |     |     |     |                     |
| payment_status        | 결제상태    | VARCHAR  | 20   | NOT NULL |     |     |     | 결제완료/결제실패/결제취소 |
| total_amount          | 결제금액    | DECIMAL  | 20   | NOT NULL |     |     |     |                     |
| rental_amount         | 대여금액    | DECIMAL  | 20   | NULL     |     |     |     |                     |
| insurance_fee         | 보험료     | DECIMAL  | 20   | NULL     |     |     |     |                     |
| discount_amount       | 할인금액    | DECIMAL  | 20   | NULL     |     |     |     |                     |
| mileage_used          | 마일리지사용 | DECIMAL  | 20   | NULL     |     |     |     |                     |
| mileage_earned        | 마일리지적립 | DECIMAL  | 20   | NULL     |     |     |     |                     |

#### [DISCOUNT_POLICY (할인정책)]
| 컬럼명               | 컬럼 설명   | 데이터 타입 | 길이 | NULL 여부  | PK  | FK  | UQ  | 비고                       |
|:-------------------|:----------|:---------|:----|:----------|:---:|:---:|:---:|:--------------------------|
| discount_policy_id | 할인정책ID  | INT      | -    | NOT NULL | ●   |     |     | AUTO_INCREMENT            |
| discount_type      | 할인유형    | VARCHAR  | 20   | NOT NULL |     |     |     | 금액/비율                   |
| discount_amount    | 할인금액    | DECIMAL  | 20   | NULL     |     |     |     |                           |
| discount_rate      | 할인율     | INT      | -    | NULL     |     |     |     | 1~100 정수                 |
| start_date         | 정책시작일자 | DATE     | -    | NOT NULL |     |     |     | YYYY-MM-DD                |
| end_date           | 정책종료일자 | DATE     | -    | NOT NULL |     |     |     | YYYY-MM-DD                |
| is_deleted         | 삭제여부    | BOOLEAN  | -    | NOT NULL |     |     |     |                  |

#### [MILEAGE_POLICY (마일리지정책)]
| 컬럼명               | 컬럼 설명     | 데이터 타입 | 길이 | NULL 여부  | PK  | FK  | UQ  | 비고                       |
|:-------------------|:------------|:---------|:----|:----------|:---:|:---:|:---:|:--------------------------|
| mileage_policy_id  | 마일리지정책ID | INT      | -    | NOT NULL | ●   |     |     | AUTO_INCREMENT            |
| earning_type       | 적립유형      | VARCHAR  | 20   | NOT NULL |     |     |     | 금액/비율                   |
| earning_amount     | 적립금액      | DECIMAL  | 20   | NULL     |     |     |     |                           |
| earning_rate       | 적립율       | INT      | -    | NULL     |     |     |     | 1~100 정수                 |
| start_date         | 정책시작일자   | DATE     | -    | NOT NULL |     |     |     | YYYY-MM-DD                |
| end_date           | 정책종료일자   | DATE     | -    | NOT NULL |     |     |     | YYYY-MM-DD                |
| is_deleted         | 삭제여부      | BOOLEAN  | -   | NOT NULL  |     |     |     |                  |

#### [MAINTENANCE (정비이력)]
| 컬럼명               | 컬럼 설명     | 데이터 타입 | 길이 | NULL 여부  | PK  | FK  | UQ  | 비고                       |
|:-------------------|:------------|:---------|:----|:----------|:---:|:---:|:---:|:--------------------------|
| maintenance_id     | 정비이력ID    | INT      | -    | NOT NULL | ●   |     |     | AUTO_INCREMENT            |
| car_id             | 정비차량ID    | INT      | -    | NOT NULL |     | ●   |     | CAR 참조                   |
| start_date         | 정비시작일자   | DATE     | -    | NOT NULL |     |     |     | YYYY-MM-DD                |
| end_date           | 정비완료일자   | DATE     | -    | NOT NULL |     |     |     | YYYY-MM-DD                |
| maintenance_type   | 정비유형      | VARCHAR  | 20   | NOT NULL |     |     |     | 정기/수시                   |
| maintenance_fee    | 정비비용      | DECIMAL  | 20   | NOT NULL |     |     |     |                           |
| maintenance_vendor | 정비업체명     | VARCHAR  | 50   | NOT NULL |     |     |     |                           |
| is_deleted         | 삭제여부      | BOOLEAN  | -    | NOT NULL |     |     |     |                  |

#### [REPAIR (수리이력)]
| 컬럼명               | 컬럼 설명     | 데이터 타입 | 길이 | NULL 여부  | PK  | FK  | UQ  | 비고                       |
|:-------------------|:------------|:---------|:----|:----------|:---:|:---:|:---:|:--------------------------|
| repair_id          | 수리이력ID    | INT      | -    | NOT NULL | ●   |     |     | AUTO_INCREMENT            |
| car_id             | 수리차량ID    | INT      | -    | NOT NULL |     | ●   |     | CAR 참조                   |
| accident_id        | 관련사고이력ID | INT      | -    | NOT NULL |     | ●   |     | ACCIDENT 참조              |
| start_date         | 수리시작일자   | DATE     | -    | NOT NULL |     |     |     | YYYY-MM-DD                |
| end_date           | 수리완료일자   | DATE     | -    | NOT NULL |     |     |     | YYYY-MM-DD                |
| repair_type        | 수리유형      | VARCHAR  | 20   | NOT NULL |     |     |     | 외장수리/내장수리/소모품/기타    |
| repair_fee         | 수리비용      | DECIMAL  | 20   | NOT NULL |     |     |     |                           |
| repair_vendor      | 수리업체명     | VARCHAR  | 50   | NOT NULL |     |     |     |                           |
| is_deleted         | 삭제여부      | BOOLEAN  | -    | NOT NULL |     |     |     |                           |

#### [ACCIDENT (사고이력)]
| 컬럼명               | 컬럼 설명     | 데이터 타입 | 길이 | NULL 여부  | PK  | FK  | UQ  | 비고                       |
|:-------------------|:------------|:---------|:----|:----------|:---:|:---:|:---:|:--------------------------|
| accident_id        | 사고이력ID    | INT      | -    | NOT NULL | ●   |     |     | AUTO_INCREMENT            |
| car_id             | 사고차량ID    | INT      | -    | NOT NULL |     | ●   |     | CAR 참조                   |
| rental_id          | 관련대여ID    | INT      | -    | NULL     |     | ●   |     | RENTAL 참조                |
| customer_id        | 관련운전자ID   | INT      | -    | NULL     |     | ●   |     | CUSTOMER 참조              |
| accident_datetime  | 사고일시      | DATETIME | -    | NOT NULL |     |     |     | YYYY-MM-DD HH:mm          |
| accident_type      | 사고유형      | VARCHAR  | 20   | NOT NULL |     |     |     | 충돌/단독/보행자/자연재해/단순고장/기타 |
| accident_location  | 사고장소      | VARCHAR  | 50   | NOT NULL |     |     |     |                           |
| is_deleted         | 삭제여부      | BOOLEAN  | -    | NOT NULL |     |     |     |                           |