# 02. ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¶•
<br/>

## ğŸ“‘ DDL ìŠ¤í¬ë¦½íŠ¸

### [1] í…Œì´ë¸” ìƒì„±
```sql
-- =============================================
-- File: 01_Create-Tables.sql
-- Description: Create tables for RentCar DB
-- =============================================

-- ê³ ê° (CUSTOMER)
CREATE TABLE CUSTOMER (
    customer_id       INT AUTO_INCREMENT,
    account_id        VARCHAR(50) NOT NULL UNIQUE,
    account_password  VARCHAR(50) NOT NULL,
    customer_name     VARCHAR(50) NOT NULL,
    customer_type     VARCHAR(10) NOT NULL,
    is_deleted        BOOLEAN NOT NULL DEFAULT FALSE,
    PRIMARY KEY (customer_id)
);

-- ìš´ì „ì (DRIVER)
CREATE TABLE DRIVER (
    driver_id       INT AUTO_INCREMENT,
    customer_id     INT NOT NULL,
    driver_name     VARCHAR(50) NOT NULL,
    birth_date      DATE NOT NULL,
    license_type    VARCHAR(10) NOT NULL,
    license_class   VARCHAR(10) NOT NULL,
    license_number  VARCHAR(20) NOT NULL UNIQUE,
    issue_date      DATE NOT NULL,
    expiry_date     DATE NOT NULL,
    phone           VARCHAR(20) NOT NULL UNIQUE,
    email           VARCHAR(100) NOT NULL UNIQUE,
    is_deleted      BOOLEAN NOT NULL DEFAULT FALSE,
    PRIMARY KEY (driver_id)
);

-- ì§€ì  (BRANCH)
CREATE TABLE BRANCH (
    branch_id       INT AUTO_INCREMENT,
    branch_name     VARCHAR(50) NOT NULL UNIQUE,
    address         VARCHAR(100) NOT NULL,
    phone           VARCHAR(20) NOT NULL UNIQUE,
    open_time       TIME NOT NULL,
    close_time      TIME NOT NULL,
    is_deleted      BOOLEAN NOT NULL DEFAULT FALSE,
    PRIMARY KEY (branch_id)
);

-- ì°¨ëŸ‰ (CAR)
CREATE TABLE CAR (
    car_id          INT AUTO_INCREMENT,
    branch_id       INT NOT NULL,
    car_number      VARCHAR(20) NOT NULL UNIQUE,
    car_model       VARCHAR(50) NOT NULL,
    fuel_type       VARCHAR(10) NOT NULL,
    car_year        INT NOT NULL,
    seat_count      INT NOT NULL,
    car_mileage     INT NOT NULL,
    fuel_remaining  INT NOT NULL,
    car_status      VARCHAR(10) NOT NULL DEFAULT 'ëŒ€ì—¬ê°€ëŠ¥',
    is_deleted      BOOLEAN NOT NULL DEFAULT FALSE,
    PRIMARY KEY (car_id)
);

-- ëŒ€ì—¬ (RENTAL)
CREATE TABLE RENTAL (
    rental_id       INT AUTO_INCREMENT,
    driver_id       INT NOT NULL,
    car_id          INT NOT NULL,
    start_datetime  DATETIME NOT NULL,
    end_datetime    DATETIME NOT NULL,
    return_datetime DATETIME NULL,
    insurance_type  VARCHAR(20) NOT NULL,
    start_fuel      INT NOT NULL,
    return_fuel     INT NULL,
    rental_status   VARCHAR(20) NOT NULL DEFAULT 'ì˜ˆì•½ì™„ë£Œ',
    PRIMARY KEY (rental_id)
);

-- ê²°ì œ (PAYMENT)
CREATE TABLE PAYMENT (
    payment_id        INT AUTO_INCREMENT,
    rental_id         INT NULL,
    compensation_id   INT NULL,
    payment_datetime  DATETIME NOT NULL DEFAULT NOW(),
    total_amount      DECIMAL(20,2) NOT NULL,
    payment_type      VARCHAR(20) NOT NULL,
    payment_method    VARCHAR(50) NOT NULL,
    payment_method_id VARCHAR(50) NOT NULL,
    payment_status    VARCHAR(20) NOT NULL,
    rental_amount     DECIMAL(20,2) NULL,
    insurance_fee     DECIMAL(20,2) NULL,
    discount_amount   DECIMAL(20,2) NULL,
    mileage_used      DECIMAL(20,2) NULL,
    mileage_earned    DECIMAL(20,2) NULL,
    PRIMARY KEY (payment_id)
);

-- í• ì¸ì •ì±… (DISCOUNT_POLICY)
CREATE TABLE DISCOUNT_POLICY (
    discount_policy_id INT AUTO_INCREMENT,
    discount_type      VARCHAR(20) NOT NULL,
    discount_amount    DECIMAL(20,2) NULL,
    discount_rate      INT NULL,
    start_date         DATE NOT NULL,
    end_date           DATE NOT NULL,
    is_deleted         BOOLEAN NOT NULL DEFAULT FALSE,
    PRIMARY KEY (discount_policy_id)
);

-- ë§ˆì¼ë¦¬ì§€ì •ì±… (MILEAGE_POLICY)
CREATE TABLE MILEAGE_POLICY (
    mileage_policy_id  INT AUTO_INCREMENT,
    earning_type       VARCHAR(20) NOT NULL,
    earning_amount     DECIMAL(20,2) NULL,
    earning_rate       INT NULL,
    start_date         DATE NOT NULL,
    end_date           DATE NOT NULL,
    is_deleted         BOOLEAN NOT NULL DEFAULT FALSE,
    PRIMARY KEY (mileage_policy_id)
);

-- ì •ë¹„ì´ë ¥ (MAINTENANCE)
CREATE TABLE MAINTENANCE (
    maintenance_id     INT AUTO_INCREMENT,
    car_id             INT NOT NULL,
    start_date         DATE NOT NULL,
    end_date           DATE NOT NULL,
    maintenance_type   VARCHAR(20) NOT NULL,
    maintenance_fee    DECIMAL(20,2) NOT NULL,
    maintenance_vendor VARCHAR(50) NOT NULL,
    is_deleted         BOOLEAN NOT NULL DEFAULT FALSE,
    PRIMARY KEY (maintenance_id)
);

-- ì‚¬ê³ ì´ë ¥ (ACCIDENT)
CREATE TABLE ACCIDENT (
    accident_id        INT AUTO_INCREMENT,
    car_id             INT NOT NULL,
    rental_id          INT NULL,
    driver_id          INT NULL,
    accident_datetime  DATETIME NOT NULL,
    accident_type      VARCHAR(20) NOT NULL,
    accident_location  VARCHAR(50) NOT NULL,
    is_deleted         BOOLEAN NOT NULL DEFAULT FALSE,
    PRIMARY KEY (accident_id)
);

-- ìˆ˜ë¦¬ì´ë ¥ (REPAIR)
CREATE TABLE REPAIR (
    repair_id      INT AUTO_INCREMENT,
    car_id         INT NOT NULL,
    accident_id    INT NULL,
    start_date     DATE NOT NULL,
    end_date       DATE NOT NULL,
    repair_type    VARCHAR(20) NOT NULL,
    repair_fee     DECIMAL(20,2) NOT NULL,
    repair_vendor  VARCHAR(50) NOT NULL,
    is_deleted     BOOLEAN NOT NULL DEFAULT FALSE,
    PRIMARY KEY (repair_id)
);

-- ë³´ìƒì´ë ¥ (COMPENSATION)
CREATE TABLE COMPENSATION (
    compensation_id     INT AUTO_INCREMENT,
    accident_id         INT NOT NULL,
    compensation_amount DECIMAL(20,2) NOT NULL,
    compensation_date   DATE NOT NULL,
    is_deleted          BOOLEAN NOT NULL DEFAULT FALSE,
    PRIMARY KEY (compensation_id)
);
```

### [2] ì œì•½ì¡°ê±´ ì„¤ì •
```sql
-- =============================================
-- File: 02_Create-Constraints.sql
-- Description: Define FK & CHECK constraints
-- =============================================

-- CUSTOMER
ALTER TABLE CUSTOMER
ADD CONSTRAINT chk_customer_type CHECK (customer_type IN ('ê°œì¸','ë²•ì¸'));

-- DRIVER
ALTER TABLE DRIVER
ADD CONSTRAINT fk_driver_customer FOREIGN KEY (customer_id) REFERENCES CUSTOMER(customer_id),
ADD CONSTRAINT chk_license_type CHECK (license_type IN ('êµ­ë‚´','êµ­ì œ')),
ADD CONSTRAINT chk_license_class CHECK (license_class IN ('1ì¢…ëŒ€í˜•','1ì¢…ë³´í†µ','2ì¢…ë³´í†µ','2ì¢…ì˜¤í† '));

-- CAR
ALTER TABLE CAR
ADD CONSTRAINT fk_car_branch FOREIGN KEY (branch_id) REFERENCES BRANCH(branch_id),
ADD CONSTRAINT chk_fuel_type CHECK (fuel_type IN ('ê°€ì†”ë¦°','ë””ì ¤','ì „ê¸°','í•˜ì´ë¸Œë¦¬ë“œ','LPG')),
ADD CONSTRAINT chk_car_year CHECK (car_year BETWEEN 2020 AND YEAR(CURDATE())),
ADD CONSTRAINT chk_seat_count CHECK (seat_count > 0),
ADD CONSTRAINT chk_car_mileage CHECK (car_mileage >= 0),
ADD CONSTRAINT chk_fuel_remaining CHECK (fuel_remaining >= 0),
ADD CONSTRAINT chk_car_status CHECK (car_status IN ('ëŒ€ì—¬ê°€ëŠ¥','ì˜ˆì•½ì™„ë£Œ','ëŒ€ì—¬ì¤‘','ì •ë¹„ì¤‘','ìˆ˜ë¦¬ì¤‘'));

-- RENTAL
ALTER TABLE RENTAL
ADD CONSTRAINT fk_rental_driver FOREIGN KEY (driver_id) REFERENCES DRIVER(driver_id),
ADD CONSTRAINT fk_rental_car FOREIGN KEY (car_id) REFERENCES CAR(car_id),
ADD CONSTRAINT chk_insurance_type CHECK (insurance_type IN ('ì™„ì „ë³´í—˜','ë¶€ë¶„ë³´í—˜','ë¯¸ì ìš©')),
ADD CONSTRAINT chk_start_fuel CHECK (start_fuel BETWEEN 1 AND 10),
ADD CONSTRAINT chk_return_fuel CHECK (return_fuel BETWEEN 1 AND 10),
ADD CONSTRAINT chk_rental_status CHECK (rental_status IN ('ì˜ˆì•½ì™„ë£Œ','ëŒ€ì—¬ì¤‘','ë°˜ë‚©ì™„ë£Œ','ì·¨ì†Œ'));

-- PAYMENT
ALTER TABLE PAYMENT
ADD CONSTRAINT fk_payment_rental FOREIGN KEY (rental_id) REFERENCES RENTAL(rental_id),
ADD CONSTRAINT fk_payment_compensation FOREIGN KEY (compensation_id) REFERENCES COMPENSATION(compensation_id),
ADD CONSTRAINT chk_payment_type CHECK (payment_type IN ('ëŒ€ì—¬','ë³´ìƒ','ì¶”ê°€')),
ADD CONSTRAINT chk_payment_method CHECK (payment_method IN ('ì‹ ìš©ì¹´ë“œ','ì²´í¬ì¹´ë“œ','ê³„ì¢Œì´ì²´','ê°„í¸ê²°ì œ')),
ADD CONSTRAINT chk_payment_status CHECK (payment_status IN ('ê²°ì œì™„ë£Œ','ê²°ì œì‹¤íŒ¨','ê²°ì œì·¨ì†Œ'));

-- DISCOUNT_POLICY
ALTER TABLE DISCOUNT_POLICY
ADD CONSTRAINT chk_discount_type CHECK (discount_type IN ('ê¸ˆì•¡','ë¹„ìœ¨')),
ADD CONSTRAINT chk_discount_rate CHECK (discount_rate BETWEEN 1 AND 100);

-- MILEAGE_POLICY
ALTER TABLE MILEAGE_POLICY
ADD CONSTRAINT chk_earning_type CHECK (earning_type IN ('ê¸ˆì•¡','ë¹„ìœ¨')),
ADD CONSTRAINT chk_earning_rate CHECK (earning_rate BETWEEN 1 AND 100);

-- MAINTENANCE
ALTER TABLE MAINTENANCE
ADD CONSTRAINT fk_maintenance_car FOREIGN KEY (car_id) REFERENCES CAR(car_id),
ADD CONSTRAINT chk_maintenance_type CHECK (maintenance_type IN ('ì •ê¸°','ìˆ˜ì‹œ'));

-- ACCIDENT
ALTER TABLE ACCIDENT
ADD CONSTRAINT fk_accident_car FOREIGN KEY (car_id) REFERENCES CAR(car_id),
ADD CONSTRAINT fk_accident_rental FOREIGN KEY (rental_id) REFERENCES RENTAL(rental_id),
ADD CONSTRAINT fk_accident_driver FOREIGN KEY (driver_id) REFERENCES DRIVER(driver_id),
ADD CONSTRAINT chk_accident_type CHECK (accident_type IN ('ì¶©ëŒ','ë‹¨ë…','ë³´í–‰ì','ìì—°','ê¸°íƒ€'));

-- REPAIR
ALTER TABLE REPAIR
ADD CONSTRAINT fk_repair_car FOREIGN KEY (car_id) REFERENCES CAR(car_id),
ADD CONSTRAINT fk_repair_accident FOREIGN KEY (accident_id) REFERENCES ACCIDENT(accident_id),
ADD CONSTRAINT chk_repair_type CHECK (repair_type IN ('ì™¸ì¥ìˆ˜ë¦¬','ë‚´ì¥ìˆ˜ë¦¬','ì†Œëª¨í’ˆ','ê¸°íƒ€'));

-- COMPENSATION
ALTER TABLE COMPENSATION
ADD CONSTRAINT fk_compensation_accident FOREIGN KEY (accident_id) REFERENCES ACCIDENT(accident_id);
```

### [3] ì¸ë±ìŠ¤ ì •ì˜
```sql
-- =============================================
-- File: 03_Create-Indexes.sql
-- Description: Create indexes for RentCar DB
-- =============================================

CREATE INDEX idx_customer_name ON CUSTOMER(customer_name);
CREATE INDEX idx_driver_license_number ON DRIVER(license_number);
CREATE INDEX idx_car_status ON CAR(car_status);
CREATE INDEX idx_rental_status ON RENTAL(rental_status);
CREATE INDEX idx_payment_datetime ON PAYMENT(payment_datetime);
CREATE INDEX idx_accident_datetime ON ACCIDENT(accident_datetime);
CREATE INDEX idx_repair_date ON REPAIR(start_date, end_date);
```